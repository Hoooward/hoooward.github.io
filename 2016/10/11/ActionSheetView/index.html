<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 比 UIAlertController 更好的选择 · Hexo</title><meta name="description" content="比 UIAlertController 更好的选择 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Hexo"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/1855353313/" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/Hoooward" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">比 UIAlertController 更好的选择</h1><div class="post-info">Oct 11, 2016</div><div class="post-content"><p>在 iOS 开发中我们会经常使用到 <code>UIAlertController</code>, 但本身提供的 API 接口有限, 自定义外观会非常麻烦, 更别提在其中使用自定义的 View 了. 今天我们来封装一个 <code>ActionSheetView</code>, 用来代替系统提供的 <code>actionSheet</code> 类型. </p>
<p><img src="http://7xrfzx.com1.z0.glb.clouddn.com/2016-11-13-屏幕快照 2016-11-13 下午1.46.14.png" alt="屏幕快照 2016-11-13 下午1.46.14"></p>
<p>图中底部弹出的菜单就是我们要实现的 <code>ActionSheetView</code>, 它有的主体结构是由一个 <code>UITableView</code> 来实现, 我们可以为其定制非常多种类的 <code>UITableViewCell</code>, 并通过 Swift 中的枚举关联值的特性,让其外部使用变得非常简单. 比如下面这种拥有 switch 开关的 cell.<br><a id="more"></a><br><img src="http://7xrfzx.com1.z0.glb.clouddn.com/2016-11-13-屏幕快照 2016-11-13 下午1.45.18.png" alt="屏幕快照 2016-11-13 下午1.45.18"><br>首先, 我们来创建一个 <code>ActionSheetView</code> 类, 它继承自 UIView. 我们在其中定义一个 Enum, 用来表示所以类型的 <code>UITableViewCell</code>.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActionSheetView</span>: <span class="title">UIView</span> </span>&#123;</div><div class="line">   </div><div class="line">   <span class="class"><span class="keyword">enum</span> <span class="title">Item</span> </span>&#123;</div><div class="line">       <span class="keyword">case</span> <span class="type">Option</span>(title: <span class="type">String</span>, titleColor: <span class="type">UIColor</span>, action: () -&gt; <span class="type">Void</span>)</div><div class="line">       <span class="keyword">case</span> <span class="type">Default</span>(title: <span class="type">String</span>, titleColor: <span class="type">UIColor</span>, action: () -&gt; <span class="type">Bool</span>)</div><div class="line">       <span class="keyword">case</span> <span class="type">Detail</span>(title: <span class="type">String</span>, titleColor: <span class="type">UIColor</span>, action: () -&gt; <span class="type">Void</span>)</div><div class="line">       <span class="keyword">case</span> <span class="type">Switch</span>(title: <span class="type">String</span>, titleColor: <span class="type">UIColor</span>, switchOn: <span class="type">Bool</span>, </div><div class="line">       action: (<span class="number">_</span> switchOn: <span class="type">Bool</span>) -&gt; <span class="type">Void</span>)</div><div class="line">       <span class="keyword">case</span> <span class="type">SubtitleSwitch</span>(title: <span class="type">String</span>, titleColor: <span class="type">UIColor</span>, subtitle: <span class="type">String</span>, </div><div class="line">       subtitleColor: <span class="type">UIColor</span>, switchOn: <span class="type">Bool</span>, </div><div class="line">       action: (<span class="number">_</span> switchOn: <span class="type">Bool</span>) -&gt; <span class="type">Void</span>)</div><div class="line">       <span class="keyword">case</span> <span class="type">Check</span>(title: <span class="type">String</span>, titleColor: <span class="type">UIColor</span>, checked: <span class="type">Bool</span>, </div><div class="line">       action: () -&gt; <span class="type">Void</span>)</div><div class="line">       <span class="keyword">case</span> <span class="type">Cancel</span></div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>接着创建一个 <code>Item</code> 的数组, 并实现 <code>init</code> 方法. 我们使用外部传入的 <code>Item</code> 数组来进行 <code>ActionSheetView</code> 的配置.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> items: [<span class="type">Item</span>]</div><div class="line"></div><div class="line"><span class="keyword">init</span>(items: [<span class="type">Item</span>]) &#123;</div><div class="line">      <span class="keyword">self</span>.items = items</div><div class="line">      <span class="keyword">super</span>.<span class="keyword">init</span>(frame: <span class="type">CGRect</span>.zero)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面我们来创建需要使用到的 UIView.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">fileprivate <span class="built_in">lazy</span> <span class="keyword">var</span> containerView: <span class="type">UIView</span> = &#123;</div><div class="line">       <span class="keyword">let</span> view = <span class="type">UIView</span>()</div><div class="line">       view.backgroundColor = <span class="type">UIColor</span>.clear</div><div class="line">       <span class="keyword">return</span> view</div><div class="line">   &#125;()</div><div class="line">   </div><div class="line"><span class="comment">// tableView 行高</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">let</span> rowHeight: <span class="type">CGFloat</span> = <span class="number">60</span></div><div class="line"></div><div class="line"><span class="comment">// tableView 的高度   </span></div><div class="line"><span class="keyword">private</span> <span class="keyword">var</span> totalHeight: <span class="type">CGFloat</span> &#123;</div><div class="line">       <span class="keyword">return</span> <span class="type">CGFloat</span>(items.<span class="built_in">count</span>) * rowHeight</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">fileprivate <span class="built_in">lazy</span> <span class="keyword">var</span> tableView: <span class="type">UITableView</span> = &#123;</div><div class="line">       <span class="keyword">let</span> view = <span class="type">UITableView</span>()</div><div class="line">       view.dataSource = <span class="keyword">self</span></div><div class="line">       view.delegate = <span class="keyword">self</span></div><div class="line">       view.rowHeight = <span class="keyword">self</span>.rowHeight</div><div class="line">       view.isScrollEnabled = <span class="literal">false</span></div><div class="line">       view.backgroundColor = <span class="type">UIColor</span>.clear</div><div class="line">       <span class="keyword">return</span> view</div><div class="line">   &#125;()</div></pre></td></tr></table></figure>
<p>上面定义的 <code>containerView</code> 其实算是整个 <code>ActionSheetView</code> 的背景视图, 与 window 大小一致. 用它来对当前屏幕的内容进行遮罩, 我们现在来定义一个 <code>makeUI</code> 的方法, 用来初始化 subViews 的 layout.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 用来保存 tableView 的底部约束. </span></div><div class="line"><span class="keyword">private</span> <span class="keyword">var</span> tableViewBottomConstraint: <span class="type">NSLayoutConstraint</span>?</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeUI</span><span class="params">()</span></span> &#123;</div><div class="line">        </div><div class="line">        addSubview(containerView)</div><div class="line">        containerView.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></div><div class="line">        </div><div class="line">        containerView.addSubview(tableView)</div><div class="line">        tableView.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></div><div class="line">        </div><div class="line">        <span class="keyword">self</span>.backgroundColor = <span class="type">UIColor</span>.clear</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> viewsDictionary: [<span class="type">String</span>: <span class="type">AnyObject</span>] = [</div><div class="line">            <span class="string">"containerView"</span>: containerView,</div><div class="line">            <span class="string">"tableView"</span>: tableView</div><div class="line">        ]</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> containerViewConstraintsH = </div><div class="line">        <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: <span class="string">"H:|[containerView]|"</span>, </div><div class="line">        options:  [], metrics: <span class="literal">nil</span>, views: viewsDictionary)</div><div class="line">        <span class="keyword">let</span> containerViewConstraintsV = </div><div class="line">        <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: <span class="string">"V:|[containerView]|"</span>, </div><div class="line">        options: [], metrics: <span class="literal">nil</span>, views: viewsDictionary)</div><div class="line">        </div><div class="line">        <span class="type">NSLayoutConstraint</span>.activate(containerViewConstraintsH)</div><div class="line">        <span class="type">NSLayoutConstraint</span>.activate(containerViewConstraintsV)</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="keyword">let</span> tableViewConstraintsH = </div><div class="line">        <span class="type">NSLayoutConstraint</span>.constraints(withVisualFormat: <span class="string">"H:|[tableView]|"</span>, </div><div class="line">        options: [], metrics: <span class="literal">nil</span>, views: viewsDictionary)</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> tableViewBottomConstraint = <span class="type">NSLayoutConstraint</span>(item: tableView, </div><div class="line">        attribute: .bottom, relatedBy: .<span class="built_in">equal</span>, toItem: containerView, </div><div class="line">        attribute: .bottom, multiplier: <span class="number">1.0</span>, constant: <span class="keyword">self</span>.totalHeight)</div><div class="line">        </div><div class="line">        <span class="keyword">self</span>.tableViewBottomConstraint = tableViewBottomConstraint</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> tableViewHeightConstraint = <span class="type">NSLayoutConstraint</span>(item: tableView, </div><div class="line">        attribute: .height, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="literal">nil</span>, </div><div class="line">        attribute: .notAnAttribute, multiplier: <span class="number">1.0</span>, constant: <span class="keyword">self</span>.totalHeight)</div><div class="line">        </div><div class="line">        <span class="type">NSLayoutConstraint</span>.activate(tableViewConstraintsH)</div><div class="line">        <span class="type">NSLayoutConstraint</span>.activate([tableViewBottomConstraint, </div><div class="line">        tableViewHeightConstraint])</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>上面的代码用 <code>containerView</code> 填充了整个屏幕, 下面为其添加一个点击事件, 用于隐藏 <code>ActionSheetView</code>. 我们将把这些代码写到 <code>didMoveToSuperView</code> 中, 并在此执行 <code>makeUI</code> 的初始化.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">var</span> isFirstTimeBeenAddedAsSubview = <span class="literal">true</span></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didMoveToSuperview</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.didMoveToSuperview()</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> isFirstTimeBeenAddedAsSubview &#123;</div><div class="line">            isFirstTimeBeenAddedAsSubview = <span class="literal">false</span></div><div class="line">            </div><div class="line">            makeUI()</div><div class="line">        </div><div class="line">            <span class="keyword">let</span> tap = <span class="type">UITapGestureRecognizer</span>(target: <span class="keyword">self</span>, action: </div><div class="line">            #selector(<span class="type">ActionSheetView</span>.hide))</div><div class="line">            containerView.addGestureRecognizer(tap)</div><div class="line">            tap.cancelsTouchesInView = <span class="literal">true</span></div><div class="line">            tap.delegate = <span class="keyword">self</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>现在我们来实现 <code>ActionSheetView</code> 的 <code>show</code> 和 <code>hide</code> 方法.  我们利用简单的动画让弹出的显得自然, 并利用之前存储的 <code>tableViewBottomConstraint</code> 属性来控制 <code>ActionSheetView</code> 的消失.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(<span class="keyword">in</span> view: UIView)</span></span> &#123;</div><div class="line">       </div><div class="line">       frame = view.bounds</div><div class="line">       </div><div class="line">       view.addSubview(<span class="keyword">self</span>)</div><div class="line">       </div><div class="line">       layoutIfNeeded()</div><div class="line">       </div><div class="line">       containerView.alpha = <span class="number">1</span></div><div class="line">       </div><div class="line">       <span class="type">UIView</span>.animate(withDuration: <span class="number">0.2</span>, delay: <span class="number">0.0</span>, options: .curveEaseIn, </div><div class="line">       animations: &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">           <span class="keyword">self</span>.containerView.backgroundColor = </div><div class="line">           <span class="type">UIColor</span>.black.withAlphaComponent(<span class="number">0.3</span>)</div><div class="line">           </div><div class="line">           &#125;, completion: &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">       &#125;)</div><div class="line">       </div><div class="line">       <span class="type">UIView</span>.animate(withDuration: <span class="number">0.2</span>, delay: <span class="number">0.1</span>, options: .curveEaseOut, </div><div class="line">       animations: &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">           <span class="keyword">self</span>.tableViewBottomConstraint?.constant = <span class="number">0</span></div><div class="line">           </div><div class="line">           <span class="keyword">self</span>.layoutIfNeeded()</div><div class="line">           </div><div class="line">           &#125;, completion: &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">       &#125;)</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="function"><span class="keyword">func</span> <span class="title">hide</span><span class="params">()</span></span> &#123;</div><div class="line">       </div><div class="line">       <span class="type">UIView</span>.animate(withDuration: <span class="number">0.2</span>, delay: <span class="number">0.0</span>, options: .curveEaseIn, </div><div class="line">       animations: &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">           <span class="keyword">self</span>.tableViewBottomConstraint?.constant = <span class="keyword">self</span>.totalHeight</div><div class="line">           </div><div class="line">           <span class="keyword">self</span>.layoutIfNeeded()</div><div class="line">           </div><div class="line">           &#125;, completion: &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">       &#125;)</div><div class="line">       </div><div class="line">       <span class="type">UIView</span>.animate(withDuration: <span class="number">0.2</span>, delay: <span class="number">0.1</span>, options: .curveEaseOut, </div><div class="line">       animations: &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">           <span class="keyword">self</span>.containerView.backgroundColor = <span class="type">UIColor</span>.clear</div><div class="line">           </div><div class="line">           &#125;, completion: &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">               <span class="keyword">self</span>.removeFromSuperview()</div><div class="line">       &#125;)</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>最后我们来完成 <code>ActionSheetView</code> 中 <code>tableView</code> 的 delegate &amp; dataSource.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ActionSheetView</span>: <span class="title">UITableViewDelegate</span>, <span class="title">UITableViewDataSource</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, numberOfRowsInSection section: Int)</span></span></div><div class="line">     -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">return</span> items.<span class="built_in">count</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> </div><div class="line">    -&gt; <span class="type">UITableViewCell</span> &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> item = items[indexPath.row]</div><div class="line">        </div><div class="line">        <span class="keyword">switch</span> item &#123;</div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Option</span>(title, titleColor, action):</div><div class="line">            <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: </div><div class="line">            <span class="type">ActionSheetOptionCell</span>.reuseIdentifier, <span class="keyword">for</span>: indexPath) <span class="keyword">as</span>!</div><div class="line">             <span class="type">ActionSheetOptionCell</span></div><div class="line">            cell.colorTitlelabel.text = title</div><div class="line">            cell.colorTitleLabeltextColor = titleColor</div><div class="line">            cell.action = action</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> cell</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Default</span>(title, titleColor, <span class="number">_</span>):</div><div class="line">            </div><div class="line">            <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: </div><div class="line">            <span class="type">ActionSheetDefaultCell</span>.reuseIdentifier) <span class="keyword">as</span>! <span class="type">ActionSheetDefaultCell</span></div><div class="line">            cell.colorTitlelabel.text = title</div><div class="line">            cell.colorTitleLabeltextColor = titleColor</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> cell</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Detail</span>(title, titleColor, action):</div><div class="line">            </div><div class="line">            <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: </div><div class="line">            <span class="type">ActionSheetDetailCell</span>.reuseIdentifier) <span class="keyword">as</span>! <span class="type">ActionSheetDetailCell</span></div><div class="line">            cell.textLabel?.text = title</div><div class="line">            cell.textLabel?.textColor = titleColor</div><div class="line">            cell.action = action</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> cell</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Switch</span>(title, titleColor, switchOn, action):</div><div class="line">            </div><div class="line">            <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: </div><div class="line">            <span class="type">ActionSheetSwitchCell</span>.reuseIdentifier) <span class="keyword">as</span>! <span class="type">ActionSheetSwitchCell</span></div><div class="line">            cell.textLabel?.text = title</div><div class="line">            cell.textLabel?.textColor = titleColor</div><div class="line">            cell.checkedSwitch.isOn = switchOn</div><div class="line">            cell.action = action</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> cell</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">SubtitleSwitch</span>(title, titleColor, subtitle, subtitleColor, </div><div class="line">        switchOn, action):</div><div class="line">            </div><div class="line">            <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: </div><div class="line">            <span class="type">ActionSheetSubtitleSwitchCell</span>.reuseIdentifier) <span class="keyword">as</span>! <span class="type">ActionSheetSubtitleSwitchCell</span></div><div class="line">            cell.titleLabel.text = title</div><div class="line">            cell.titleLabel.textColor = titleColor</div><div class="line">            cell.subtitleLabel.text = subtitle</div><div class="line">            cell.subtitleLabel.textColor = subtitleColor</div><div class="line">            cell.checkedSwitch.isOn = switchOn</div><div class="line">            cell.action = action</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> cell</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Check</span>(title, titleColor, checked, <span class="number">_</span>):</div><div class="line">            </div><div class="line">            <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier:</div><div class="line">             <span class="type">ActionSheetCheckCell</span>.reuseIdentifier) <span class="keyword">as</span>! <span class="type">ActionSheetCheckCell</span></div><div class="line">            cell.colorTitleLabel.text = title</div><div class="line">            cell.colorTitleLabelTextColor = titleColor</div><div class="line">            cell.checkImageView.isHidden = !checked</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> cell</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> .<span class="type">Cancel</span>:</div><div class="line">            </div><div class="line">            <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: </div><div class="line">            <span class="type">ActionSheetDefaultCell</span>.reuseIdentifier) <span class="keyword">as</span>! <span class="type">ActionSheetDefaultCell</span></div><div class="line">            cell.colorTitlelabel.text = <span class="type">NSLocalizedString</span>(<span class="string">"取消"</span>, comment: <span class="string">""</span>)</div><div class="line">            cell.colorTitleLabeltextColor = <span class="type">UIColor</span>.cubeTintColor()</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> cell</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, didSelectRowAt indexPath: IndexPath)</span></span> &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">defer</span> &#123;</div><div class="line">            tableView.deselectRow(at: indexPath <span class="keyword">as</span> <span class="type">IndexPath</span>, animated: <span class="literal">true</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> item = items[indexPath.row]</div><div class="line">        </div><div class="line">        <span class="keyword">switch</span> item &#123;</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> .<span class="type">Option</span>(<span class="number">_</span>, <span class="number">_</span>, <span class="keyword">let</span> action):</div><div class="line">            </div><div class="line">            hideAndDo(afterHideAction: action)</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> .<span class="type">Default</span>(<span class="number">_</span>, <span class="number">_</span>, <span class="keyword">let</span> action):</div><div class="line">            </div><div class="line">            <span class="keyword">if</span> action() &#123;</div><div class="line">                hide()</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> .<span class="type">Detail</span>(<span class="number">_</span>, <span class="number">_</span>, <span class="keyword">let</span> action):</div><div class="line">            </div><div class="line">            hideAndDo(afterHideAction: action)</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> .<span class="type">Switch</span>:</div><div class="line">            </div><div class="line">            <span class="keyword">break</span></div><div class="line">            </div><div class="line">        <span class="keyword">case</span> .<span class="type">SubtitleSwitch</span>:</div><div class="line">            </div><div class="line">            <span class="keyword">break</span></div><div class="line">            </div><div class="line">        <span class="keyword">case</span> .<span class="type">Check</span>(<span class="number">_</span>, <span class="number">_</span>, <span class="number">_</span>, <span class="keyword">let</span> action):</div><div class="line">            </div><div class="line">            action()</div><div class="line">            hide()</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> .<span class="type">Cancel</span>:</div><div class="line">            </div><div class="line">            hide()</div><div class="line">            <span class="keyword">break</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>以上代码的逻辑非常简单, 根据传入的 <code>Items</code> 实例, 为每行分配合适的 <code>UITableViewCell</code> , 并对 cell 进行配置. 在 <code>tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath)</code> 方法中, 我们在这里执行 <code>Item</code> 枚举所关联的 action. </p>
<p>另外 tableView 所使用的 cell 的实现就不一一列举了, 仅贴出 <code>ActionSheetSwitchCell</code> 的实现好了, 其他都大同小异.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionSheetSwitchCell</span>: <span class="title">UITableViewCell</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">var</span> <span class="title">reuseIdentifier</span>: <span class="title">String</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"<span class="subst">\(<span class="keyword">self</span>)</span>"</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> action: ((<span class="type">Bool</span>) -&gt; <span class="type">Void</span>)?</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(style: <span class="type">UITableViewCellStyle</span>, reuseIdentifier: <span class="type">String</span>?) &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(style: style, reuseIdentifier: reuseIdentifier)</div><div class="line">        </div><div class="line">        layoutMargins = <span class="type">UIEdgeInsets</span>(top: <span class="number">0</span>, <span class="keyword">left</span>: <span class="number">20</span>, bottom: <span class="number">0</span>, <span class="keyword">right</span>: <span class="number">20</span>)</div><div class="line">        </div><div class="line">        textLabel?.textColor = <span class="type">UIColor</span>.darkGray</div><div class="line">        textLabel?.font = <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">18</span>, weight: <span class="type">UIFontWeightLight</span>)</div><div class="line">        </div><div class="line">        makeUI()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</div><div class="line">        <span class="built_in">fatalError</span>(<span class="string">"init(coder:) has not been implemented"</span>)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> checkedSwitch: <span class="type">UISwitch</span> = &#123;</div><div class="line">        <span class="keyword">let</span> s = <span class="type">UISwitch</span>()</div><div class="line">        s.addTarget(<span class="keyword">self</span>, action: </div><div class="line">        #selector(<span class="type">ActionSheetSwitchCell</span>.toggleSwitch(<span class="number">_</span>:)), <span class="keyword">for</span>: .valueChanged)</div><div class="line">        <span class="keyword">return</span> s</div><div class="line">    &#125;()</div><div class="line">    </div><div class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">toggleSwitch</span><span class="params">(<span class="number">_</span> sender: UISwitch)</span></span> &#123;</div><div class="line">        action?(sender.isOn)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeUI</span><span class="params">()</span></span> &#123;</div><div class="line">        contentView.addSubview(checkedSwitch)</div><div class="line">        checkedSwitch.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></div><div class="line">        </div><div class="line">        <span class="keyword">let</span> centerY = <span class="type">NSLayoutConstraint</span>(item: checkedSwitch, attribute: .centerY,</div><div class="line">         relatedBy: .<span class="built_in">equal</span>, toItem: contentView, attribute: .centerY, multiplier: </div><div class="line">         <span class="number">1</span>, constant: <span class="number">0</span>)</div><div class="line">        <span class="keyword">let</span> trailing = <span class="type">NSLayoutConstraint</span>(item: checkedSwitch, </div><div class="line">        attribute: .trailing, relatedBy: .<span class="built_in">equal</span>, toItem: contentView, </div><div class="line">        attribute: .trailing, multiplier: <span class="number">1</span>, constant: -<span class="number">20</span>)</div><div class="line">        </div><div class="line">        <span class="type">NSLayoutConstraint</span>.activate([centerY, trailing])</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>OK! Done.<br>我们最后来看一下使用 <code>ActinoSheetView</code> 的代码片段.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> actionSheetView: <span class="type">ActionSheetView</span> = &#123;</div><div class="line">        <span class="keyword">var</span> items = <span class="keyword">self</span>.creatActionSheetViewItems()</div><div class="line">        items.append(<span class="type">ActionSheetView</span>.<span class="type">Item</span>.<span class="type">Cancel</span>)</div><div class="line">        <span class="keyword">let</span> sheetView = <span class="type">ActionSheetView</span>(items: items)</div><div class="line">        <span class="keyword">return</span> sheetView</div><div class="line">    &#125;()</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">creatActionSheetViewItems</span><span class="params">()</span></span> -&gt; [<span class="type">ActionSheetView</span>.<span class="type">Item</span>] &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> switchItem = <span class="type">ActionSheetView</span>.<span class="type">Item</span>.<span class="type">Switch</span>(</div><div class="line">            title: <span class="string">"同步"</span>,</div><div class="line">            titleColor: <span class="type">UIColor</span>.cubeTintColor(),</div><div class="line">            switchOn: <span class="literal">true</span>, action: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] switchOn <span class="keyword">in</span></div><div class="line">            </div><div class="line">        &#125;)</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> editItem = <span class="type">ActionSheetView</span>.<span class="type">Item</span>.<span class="type">Option</span>(</div><div class="line">            title: <span class="string">"编辑此公式"</span>,</div><div class="line">            titleColor: <span class="type">UIColor</span>.cubeTintColor(),</div><div class="line">            action: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</div><div class="line">                </div><div class="line">            &#125;)</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> deleteItem = <span class="type">ActionSheetView</span>.<span class="type">Item</span>.<span class="type">Option</span>(</div><div class="line">            title: <span class="string">"删除此公式"</span>,</div><div class="line">            titleColor: <span class="type">UIColor</span>.red,</div><div class="line">            action: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</div><div class="line">                </div><div class="line">            &#125;)</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> copyToMy = <span class="type">ActionSheetView</span>.<span class="type">Item</span>.<span class="type">Option</span>(</div><div class="line">            </div><div class="line">            title: <span class="string">"编辑并添加到公式"</span>,</div><div class="line">            titleColor: <span class="type">UIColor</span>.cubeTintColor(),</div><div class="line">            </div><div class="line">            action: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</div><div class="line">                </div><div class="line">            &#125;)</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> [switchItem, editItem, deleteItem, copyToMy]</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">showActionSheetView</span><span class="params">(<span class="number">_</span> sender: AnyObject)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> window = view.window &#123;</div><div class="line">            actionSheetView.showInView(view: window)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>之后如何希望实现更多种类的 <code>UITableViewCell</code> 只需要对 <code>Item</code> 这个枚举增加新的 case 就可以了.</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/10/20/刷新UITableView&amp;UICollectionView/" class="prev">PREV</a><a href="/2016/10/10/去除String空格/" class="next">NEXT</a></div><div data-thread-key="2016/10/11/ActionSheetView/" data-title="比 UIAlertController 更好的选择" data-url="http://yoursite.com/2016/10/11/ActionSheetView/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"seansun"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>